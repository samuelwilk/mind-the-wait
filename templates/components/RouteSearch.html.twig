<div {{ attributes }}>
    <!-- Search and Filter Bar -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
        <div class="flex flex-col md:flex-row gap-4">
            <!-- Search Input (Live) -->
            <div class="flex-1">
                <label for="search" class="block text-sm font-medium text-gray-700 mb-2">Search Routes</label>
                <input
                    type="text"
                    id="search"
                    data-model="search"
                    data-live-ignore
                    value="{{ search }}"
                    placeholder="Search by route number or name..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                >
            </div>

            <!-- Sort Select -->
            <div>
                <label for="sort" class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                <select
                    id="sort"
                    data-model="sort"
                    data-live-ignore
                    class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                >
                    <option value="name" {{ sort == 'name' ? 'selected' : '' }}>Route Number</option>
                    <option value="grade" {{ sort == 'grade' ? 'selected' : '' }}>Grade (Best First)</option>
                    <option value="performance" {{ sort == 'performance' ? 'selected' : '' }}>Performance (Best First)</option>
                </select>
            </div>
        </div>

        <!-- Results Count (Live Updated) -->
        <div class="mt-4">
            <p class="text-sm text-gray-600">
                Showing <span class="font-semibold">{{ routes|length }}</span> route{{ routes|length != 1 ? 's' : '' }}
            </p>
        </div>
    </div>

    <!-- Route List -->
    {% if routes|length > 0 %}
        <div>
            {% for route in routes %}
                <a href="{{ path('app_routes_show', {gtfsId: route.routeId}) }}"
                   class="block bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-2 hover:shadow-md hover:border-primary-300 transition">
                    <div class="flex items-start justify-between gap-6">
                        <!-- Route Info -->
                        <div class="flex items-start gap-4 flex-1 min-w-0">
                            {% include 'components/RouteBadge.html.twig' with {
                                shortName: route.shortName,
                                colour: route.colour,
                                size: 'lg'
                            } %}
                            <div class="flex-1 min-w-0">
                                <h3 class="font-semibold text-sm sm:text-lg text-gray-900 line-clamp-2 sm:truncate">{{ route.longName }}</h3>
                                <div class="mt-1 space-y-1 h-12">
                                    <p class="text-sm text-gray-600">
                                        30-Day Avg: <span class="font-semibold">{{ route.onTimePercentage|round(1) }}%</span>
                                    </p>
                                    <p class="text-sm text-gray-500">
                                        {% if route.activeVehicles > 0 %}
                                            {{ route.activeVehicles }} vehicle{{ route.activeVehicles > 1 ? 's' : '' }} active
                                        {% else %}
                                            &nbsp;
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Grade Badge -->
                        <div class="flex-shrink-0">
                            {% if route.grade == 'N/A' %}
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-lg font-bold bg-gray-100 text-gray-600">
                                    N/A
                                </span>
                            {% else %}
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-lg font-bold {% if route.grade == 'A' or route.grade == 'B' %}bg-success-100 text-success-800{% elseif route.grade == 'C' %}bg-warning-100 text-warning-800{% elseif route.grade == 'D' %}bg-warning-100 text-warning-800{% else %}bg-danger-100 text-danger-800{% endif %}">
                                    {{ route.grade }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center">
            <p class="text-gray-500">No routes found matching your search.</p>
            {% if search != '' %}
                <button
                    type="button"
                    data-action="live#action"
                    data-live-action-param="$set"
                    data-live-search-param=""
                    class="mt-4 inline-block text-primary-500 hover:text-primary-600"
                >
                    Clear search
                </button>
            {% endif %}
        </div>
    {% endif %}
</div>
